<div class="movimiento-container">

  <!-- VISTA: Listado de Movimientos -->
  <div *ngIf="!verFormulario">
    <!-- Encabezado con tÃ­tulo y botÃ³n nuevo -->
    <div class="header-section">
      <h1>Movimientos Bancarios</h1>
      <button 
        class="btn-accent" 
        (click)="abrirNuevo()" 
        title="Crear nuevo movimiento"
      >
        â• Nuevo Movimiento
      </button>
    </div>

    <!-- SecciÃ³n de filtros -->
    <div class="filters-section">
      <div class="filter-group">
        <!-- Selector de Cliente -->
        <div class="filter-field">
          <label for="clienteSelect">Seleccione un Cliente <span class="required">*</span></label>
          <select
            id="clienteSelect"
            [(ngModel)]="clienteSeleccionado"
            aria-label="Seleccionar cliente"
          >
            <option value="">-- Elija un cliente --</option>
            <option *ngFor="let cliente of clientes" [value]="cliente.clienteId">
              {{ cliente.nombre }}
            </option>
          </select>
        </div>

        <!-- Filtro de Fecha -->
        <div class="filter-field">
          <label for="fechaInicio">Desde (Fecha) <span class="optional">(opcional)</span></label>
          <input
            id="fechaInicio"
            type="date"
            [(ngModel)]="fechaInicio"
            aria-label="Filtrar por fecha de inicio"
          >
        </div>

        <!-- Botones de AcciÃ³n -->
        <div class="filter-actions">
          <button
            class="btn-filter"
            (click)="aplicarFiltros()"
            [disabled]="!clienteSeleccionado"
            title="Aplicar filtros"
          >
            ğŸ” Buscar
          </button>
          <button
            class="btn-reset"
            (click)="limpiarFiltros()"
            title="Limpiar filtros"
          >
            ğŸ”„ Limpiar
          </button>
        </div>
      </div>

      <!-- BÃºsqueda por nÃºmero de cuenta -->
      <div class="search-section" *ngIf="movimientos.length > 0">
        <input
          type="text"
          placeholder="Buscar por nÃºmero de cuenta..."
          class="search-input"
          [(ngModel)]="busqueda"
          (keyup)="buscar()"
          aria-label="Buscar movimientos por nÃºmero de cuenta"
        >
      </div>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="cargando" class="loading-indicator">
      <p>â³ Cargando movimientos...</p>
    </div>

    <!-- Tabla de movimientos -->
    <div *ngIf="!cargando && movimientos.length > 0" class="table-wrapper">
      <table class="banco-table" role="grid" aria-label="Lista de movimientos">
        <thead>
          <tr role="row">
            <th scope="col">Fecha</th>
            <th scope="col">Cliente</th>
            <th scope="col">NÃºmero Cuenta</th>
            <th scope="col">Tipo</th>
            <th scope="col">Valor</th>
            <th scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let movimiento of movimientosFiltrados; trackBy: trackByMovimiento" 
            role="row"
            [class.debito]="movimiento.tipoMovimiento === 'DEBITO'"
            [class.credito]="movimiento.tipoMovimiento === 'CREDITO'"
          >
            <td data-label="Fecha">{{ formatearFecha(movimiento.fecha) }}</td>
            <td data-label="Cliente">{{ obtenerNombreCliente(movimiento.clienteId) }}</td>
            <td data-label="NÃºmero Cuenta">{{ movimiento.numeroCuenta }}</td>
            <td data-label="Tipo">
              <span 
                class="badge" 
                [class.debito]="movimiento.tipoMovimiento === 'DEBITO'"
                [class.credito]="movimiento.tipoMovimiento === 'CREDITO'"
              >
                {{ movimiento.tipoMovimiento === 'DEBITO' ? 'ğŸ’” DÃ©bito' : 'ğŸ’š CrÃ©dito' }}
              </span>
            </td>
            <td data-label="Valor" [class.debito]="movimiento.tipoMovimiento === 'DEBITO'">
              <span [class.negative]="movimiento.tipoMovimiento === 'DEBITO'">
                {{ movimiento.tipoMovimiento === 'DEBITO' ? '-' : '+' }}{{ formatearValor(movimiento.valor) }}
              </span>
            </td>
            <td data-label="Acciones" class="actions">
              <button
                class="btn-icon delete"
                (click)="onDelete(movimiento.id)"
                title="Eliminar movimiento"
                aria-label="Eliminar movimiento"
              >
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Documento vacÃ­o -->
    <div 
      *ngIf="!cargando && movimientos.length === 0 && !clienteSeleccionado" 
      class="empty-state"
    >
      <div class="empty-icon">ğŸ“‹</div>
      <h2>Sin movimientos</h2>
      <p>Seleccione un cliente para ver sus movimientos</p>
    </div>

    <!-- Mensaje cuando no hay resultados -->
    <div 
      *ngIf="!cargando && movimientos.length > 0 && movimientosFiltrados.length === 0" 
      class="no-results"
    >
      <p>No se encontraron movimientos con los criterios de bÃºsqueda.</p>
    </div>

    <!-- Mensaje cuando la bÃºsqueda no devuelve resultados -->
    <div 
      *ngIf="!cargando && clienteSeleccionado && movimientos.length === 0" 
      class="no-results"
    >
      <p>No hay movimientos para el cliente seleccionado en el perÃ­odo especificado.</p>
    </div>
  </div>

  <!-- VISTA: Formulario de Movimientos -->
  <div *ngIf="verFormulario">
    <div class="header-section">
      <h1>Crear Nuevo Movimiento</h1>
    </div>

    <app-movimiento-form
      (onSave)="guardar($event)"
      (onCancel)="cancelar()"
      aria-label="Formulario de movimientos"
    ></app-movimiento-form>
  </div>

</div>
